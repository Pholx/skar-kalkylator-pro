<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Skärdatakalkylator - Planfräsning</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* CSS-STYLING FÖR DENNA KALKYLATOR */
        /* Observera: Vissa variabler (t.ex. --bg, --card) är definierade i index.html */
        :root {
            --bg: #f8fafc; --card: #ffffff; --text: #1e293b; --text-light: #64748b;
            --primary: #3b82f6; --success: #10b981; --warning: #f59e0b; --danger: #ef4444;
            --border: #e2e8f0; --shadow: 0 20px 40px rgba(0,0,0,0.08); --radius: 16px;
        }
        @media (prefers-color-scheme: dark) {
            :root { --bg: #0f172a; --card: #1e293b; --text: #f1f5f9; --text-light: #94a3b8;
                    --border: #334155; --shadow: 0 20px 40px rgba(0,0,0,0.4); }
        }
        body.dark { --bg: #0f172a; --card: #1e293b; --text: #f1f5f9; --text-light: #94a3b8;
                    --border: #334155; --shadow: 0 20px 40px rgba(0,0,0,0.4); }
        
        * { margin:0; padding:0; box-sizing:border-box; }
        body { font-family:'Inter',sans-serif; background:var(--bg); color:var(--text); padding:0; transition:all .4s; }
        .container { max-width:560px; margin:0 auto; background:var(--card); padding: 0; box-shadow:none; border-radius: 0;}
        header { background:linear-gradient(135deg,#667eea,#764ba2); color:white; padding:30px 24px; text-align:center; position:relative; }
        h1 { font-size:1.8rem; font-weight:700; margin-bottom:8px; }
        .subtitle { font-size:0.9rem; opacity:0.9; }
        main { padding:32px 24px; }
        
        /* FORM STYLING */
        .form-group { margin-bottom: 24px; }
        label { display:block; margin-bottom:8px; font-weight:600; font-size:0.95rem; }
        select, input[type=number] { width:100%; padding:14px 16px; border:2px solid var(--border);
            border-radius:12px; background:var(--card); color:var(--text); font-size:1rem;
            transition:all .3s; }
        select:focus, input[type=number]:focus { border-color:var(--primary); outline:none; }
        
        /* GEOMETRY TOGGLE */
        .geo-container { display: flex; background: var(--bg); border-radius: 12px; overflow: hidden; }
        .geo-btn { flex: 1; padding: 12px 10px; text-align: center; border: 2px solid var(--border); 
                   background: var(--card); color: var(--text-light); cursor: pointer; 
                   transition: all .2s; border-right: none; }
        .geo-btn:first-child { border-top-left-radius: 10px; border-bottom-left-radius: 10px; }
        .geo-btn:last-child { border-right: 2px solid var(--border); border-top-right-radius: 10px; border-bottom-right-radius: 10px; }
        .geo-btn.active { background: var(--primary); color: white; border-color: var(--primary); }
        .geo-btn.active + .geo-btn { border-left-color: var(--primary); }

        /* RESULTS STYLING */
        .results { 
            background: var(--primary-light); 
            padding: 24px; 
            border-radius: 12px; 
            margin-top: 32px; 
            color: var(--text);
            transition: background .4s;
        }
        body.dark .results { 
            background: #1e3a8a; /* Mörkare blå i dark mode */
            color: white;
        }
        .results h2 { 
            font-size: 1.4rem; 
            font-weight: 700; 
            margin-bottom: 16px; 
            color: var(--primary); 
            transition: color .4s;
        }
        body.dark .results h2 { color: #93c5fd; }
        .result-line { 
            display: flex; 
            justify-content: space-between; 
            font-size: 1.1rem; 
            font-weight: 600; 
            padding: 8px 0;
            border-bottom: 1px solid rgba(0,0,0,0.1);
        }
        body.dark .result-line { border-bottom: 1px solid rgba(255,255,255,0.1); }
        .result-line:last-of-type { border-bottom: none; margin-bottom: 8px; }
        .value { color: var(--text); font-weight: 700; }
        .value.capped { color: var(--danger); }
        .details { 
            margin-top: 16px; 
            padding-top: 12px; 
            border-top: 1px solid var(--border); 
            font-size: 0.85rem; 
            color: var(--text-light);
        }
        .details p { margin-bottom: 4px; }
        
        /* TEMAKNAPP (TA BORT DENNA CSS om du inte vill ha den i iframe) */
        /* .theme-toggle { position: absolute; top: 16px; right: 16px; ... } */

        /* TOOL BADGE */
        .tool-badge { position:absolute; top:16px; left:16px; padding:6px 14px;
                      border-radius:50px; font-size:0.8rem; font-weight:700;
                      text-transform:uppercase; letter-spacing:0.5px; background:#1d4ed8; color:white; }
    </style>
</head>
<body>

<div class="container">
    <header>
        <div class="tool-badge">HM</div>
        <h1>Skärdatakalkylator</h1>
        <p class="subtitle">Planfräsning – Kappa-/Rundskär (0.5–25 mm)</p>
        </header>

    <main>
        <div class="form-group">
            <label>Skärgeometri (Kappa- eller Rundskär)</label>
            <div class="geo-container">
                <div class="geo-btn active" data-geo="kappa">Kappa/Square</div>
                <div class="geo-btn" data-geo="runda">Runda</div>
            </div>
        </div>

        <div class="form-group">
            <label for="material_group">Materialgrupp</label>
            <select id="material_group">
                <option value="default" disabled selected>Välj materialgrupp...</option>
                <option value="P">Stål (P)</option>
                <option value="M">Rostfritt (M)</option>
                <option value="K">Gjutjärn (K)</option>
                <option value="N">Icke-järn (N)</option>
                <option value="S">Högtemp/Titan (S)</option>
                <option value="H">Härdat stål (H)</option>
            </select>
        </div>

        <div class="form-group" id="material_select_group" style="display: none;">
            <label for="material_type">Material (typ)</label>
            <select id="material_type">
                </select>
        </div>

        <div class="form-group">
            <label for="diameter">Fräsdiameter (D, mm)</label>
            <input type="number" id="diameter" value="40" min="5" step="5">
        </div>

        <div class="form-group">
            <label for="teeth">Antal skär (z)</label>
            <input type="number" id="teeth" value="5" min="1" step="1">
        </div>

        <div class="form-group">
            <label for="ae_percent">Radiell ingrepp (Ae, % av D)</label>
            <input type="number" id="ae_percent" value="80" min="1" max="100" step="10">
        </div>

        <div class="form-group">
            <label for="ap">Axial ingreppsdjup (Ap, mm)</label>
            <input type="number" id="ap" value="2.0" min="0.1" step="0.5">
        </div>

        <div class="form-group">
            <label for="max_rpm">Maskinens max RPM</label>
            <input type="number" id="max_rpm" value="10000" min="1000" step="1000">
        </div>

        <div class="results" id="results">
            <p style="text-align:center; padding:20px 0; color:var(--text-light);">
                Fyll i alla fält för att få skärdata
            </p>
        </div>
    </main>
</div>

<script>
    // JS-LOGIK
    const cuttingData = {
        P: { 
            /* ... (Dina data här) ... */ 
            "P1.2": { name: "Olegerat stål (350-500 N/mm²)", Vc_kappa: 250, Vc_runda: 220, fz: 0.20 },
            "P2.2": { name: "Konstruktionsstål (500-800 N/mm²)", Vc_kappa: 220, Vc_runda: 200, fz: 0.18 },
            "P3.2": { name: "Seghärdat stål (800-1100 N/mm²)", Vc_kappa: 180, Vc_runda: 160, fz: 0.15 },
        },
        M: { 
            /* ... (Dina data här) ... */ 
            "M1.2": { name: "Rostfritt stål, Martensitiskt", Vc_kappa: 150, Vc_runda: 140, fz: 0.15 },
        },
        K: { 
            /* ... (Dina data här) ... */ 
            "K1.1": { name: "Gråjärn", Vc_kappa: 280, Vc_runda: 250, fz: 0.25 },
        },
        N: { 
            /* ... (Dina data här) ... */ 
            "N1.2": { name: "Aluminium (Gjuten/Låg kisel)", Vc_kappa: 450, Vc_runda: 400, fz: 0.30 },
        },
        S: { 
            /* ... (Dina data här) ... */ 
            "S2.1": { name: "Titanlegeringar", Vc_kappa: 60, Vc_runda: 50, fz: 0.12 },
        },
        H: { 
            /* ... (Dina data här) ... */ 
            "H1.1": { name: "Härdat stål (>55 HRC)", Vc_kappa: 80, Vc_runda: 70, fz: 0.08 },
        }
    };

    let currentGeometry = 'kappa'; // 'kappa' or 'runda'
    const inputIds = ['diameter', 'teeth', 'ae_percent', 'ap', 'max_rpm', 'material_type'];

    // Laddar materialdata i dropdown
    function loadMaterialData() {
        const group = document.getElementById('material_group').value;
        const select = document.getElementById('material_type');
        select.innerHTML = '<option value="default" disabled selected>Välj material...</option>';
        
        if (cuttingData[group]) {
            for (const key in cuttingData[group]) {
                const mat = cuttingData[group][key];
                select.innerHTML += `<option value="${key}">${key} – ${mat.name}</option>`;
            }
            document.getElementById('material_select_group').style.display = 'block';
        } else {
            document.getElementById('material_select_group').style.display = 'none';
        }
        calculate();
    }

    // Ändrar mellan Kappa/Runda
    function toggleGeometry(event) {
        const target = event.target.closest('.geo-btn');
        if (!target) return;

        document.querySelectorAll('.geo-btn').forEach(btn => btn.classList.remove('active'));
        target.classList.add('active');
        
        currentGeometry = target.dataset.geo;
        calculate();
    }
    
    // Huvudberäkningsfunktion
    function calculate() {
        const matKey = document.getElementById('material_type').value;
        if (matKey === 'default') {
             document.getElementById('results').innerHTML = `<p style="text-align:center; padding:20px 0; color:var(--text-light);">Fyll i alla fält för att få skärdata</p>`;
            return;
        }

        const matGroup = document.getElementById('material_group').value;
        const mat = cuttingData[matGroup][matKey];
        const D = parseFloat(document.getElementById('diameter').value);
        const z = parseFloat(document.getElementById('teeth').value);
        const ae_pct = parseFloat(document.getElementById('ae_percent').value);
        const ap = parseFloat(document.getElementById('ap').value);
        const maxRpm = parseFloat(document.getElementById('max_rpm').value);

        if (!(D > 0 && z > 0 && ae_pct >= 1 && ap > 0 && maxRpm > 0)) {
            document.getElementById('results').innerHTML = `<p style="text-align:center; padding:20px 0; color:var(--text-light);">Kontrollera inmatade värden (måste vara > 0)</p>`;
            return;
        }

        const Vc = currentGeometry === 'kappa' ? mat.Vc_kappa : mat.Vc_runda;
        const fz = mat.fz;
        const ae_mm = (D * ae_pct) / 100;
        
        // 1. Varvtal (n)
        let n = (Vc * 1000) / (Math.PI * D);
        let n_final = n;
        let capped = false;

        if (n > maxRpm) {
            n_final = maxRpm;
            capped = true;
        }

        // 2. Bordmatning (Vf)
        const Vf = n_final * z * fz;
        
        // 3. Spåntjockleksfaktor (K-faktor, förenklad)
        let K = 1;
        if (currentGeometry === 'kappa' && ae_pct < 50) {
            // Endast vid litet radiellt ingrepp
            const he_max = (fz * Math.sqrt((ae_mm / D) * (1 - (ae_mm / D))));
            const h = (D / 2) * (1 - Math.sqrt(1 - (2 * he_max / (D))));
            K = 1.0; // Förenklat: Kan anpassas baserat på geometri/he-max
        }
        
        // 4. Effektfaktorer (Förenklat till 1 för enkel kalkylator)
        const Fd = 1; // Diameterfaktor (ofta 1)
        const Fa = 1; // Axialfaktor (ofta 1)
        
        // Final Vf med faktorer
        const Vf_final = Vf * K * Fd * Fa;


        // Visa resultat
        document.getElementById('results').innerHTML = `
            <h2>${currentGeometry === 'kappa' ? 'Kappa/Square' : 'Runda'} – Skärdata</h2>
            <div class="result-line">
                <strong>Varvtal (n)</strong> 
                <span class="value ${capped?'capped':''}">${n_final.toLocaleString('sv', { maximumFractionDigits: 0 })} varv/min${capped?' *':''}</span>
            </div>
            <div class="result-line">
                <strong>Bordmatning (Vf)</strong> 
                <span class="value">${Vf_final.toLocaleString('sv', { maximumFractionDigits: 0 })} mm/min</span>
            </div>
            
            <div class="details">
                <p><strong>Skärhastighet (Vc):</strong> ${Vc} m/min</p>
                <p><strong>Matning per skär (fz):</strong> ${fz} mm/tand</p>
                <p><strong>Axial ingrepp (ap):</strong> ${ap} mm</p>
                <p>
                    <strong>Radiell ingrepp (ae):</strong> 
                    <span class="detail-value">${ae_mm.toFixed(1)} mm (${ae_pct} % av D)</span>
                </p>
                ${capped ? '<p class="warning-text" style="color: var(--danger); margin: 8px 0;">* Varvtalet är begränsat av max-RPM</p>' : ''}
            </div>
        `;
    }

    // Events
    document.getElementById('material_group').addEventListener('change', loadMaterialData);
    
    // Geometry toggles
    document.querySelectorAll('.geo-btn').forEach(btn => btn.addEventListener('click', toggleGeometry));

    // Input fields for automatic calculation
    inputIds.forEach(id => {
        const el = document.getElementById(id);
        if (el) el.addEventListener('input', calculate);
    });
    document.getElementById('ae_percent').addEventListener('change', calculate); 

    // Starta
    document.addEventListener('DOMContentLoaded', loadMaterialData);
    
    // Den gamla TEMALOGIKEN är BORTTAGEN HÄR

</script>
</body>
</html>
