<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sk√§rdata PRO | Kalkylator</title>
    
    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="/icon-192.png" sizes="192x192" type="image/png">
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* === GLOBAL TEMAVARIABLER (Matchar Fragmenten) === */
        :root {
            --bg: #f8fafc; --card: #ffffff; --text: #1e293b; --text-light: #64748b;
            --primary: #3b82f6; --primary-light: #dbeafe; --success: #10b981; 
            --warning: #f59e0b; --danger: #ef4444; --border: #e2e8f0; 
            --shadow: 0 20px 40px rgba(0,0,0,0.08); --radius: 16px;
        }
        /* M√∂rkt l√§ge: systeminst√§llningar */
        @media (prefers-color-scheme: dark) {
            :root { --bg: #0f172a; --card: #1e293b; --text: #f1f5f9; --text-light: #94a3b8;
                    --border: #334155; --shadow: 0 20px 40px rgba(0,0,0,0.4); --primary-light: #1e3a8a; }
        }
        /* M√∂rkt l√§ge: Manuell toggle */
        body.dark {
            --bg: #0f172a; --card: #1e293b; --text: #f1f5f9; --text-light: #94a3b8;
            --border: #334155; --shadow: 0 20px 40px rgba(0,0,0,0.4); --primary-light: #1e3a8a;
        }

        /* === GLOBAL LAYOUT === */
        * { margin:0; padding:0; box-sizing:border-box; }
        body { font-family:'Inter',sans-serif; background:var(--bg); color:var(--text); padding:0; transition:all .4s; }
        .app-container { max-width:600px; margin:0 auto; display:flex; flex-direction:column; min-height:100vh; background:var(--card); box-shadow:var(--shadow); }
        
        /* === HEADER === */
        header { background:linear-gradient(135deg,#667eea,#764ba2); color:white; padding:24px 20px 16px; text-align:center; position:relative; }
        .header-content { display:flex; justify-content:space-between; align-items:center; }
        .logo-text { font-size:1.5rem; font-weight:700; }

        /* === THEME TOGGLE (M√∂rk/Ljus) === */
        .theme-toggle { padding:8px 12px; border:none; background:rgba(255,255,255,0.2); 
                        color:white; border-radius:12px; cursor:pointer; font-size:1.2rem;
                        transition:all .2s; }
        .theme-toggle:hover { background:rgba(255,255,255,0.3); }

        /* === NAVIGATION BAR === */
        .nav-bar { display:flex; justify-content:space-between; padding:0 20px; background:var(--card); border-bottom:1px solid var(--border); }
        .nav-tab { flex:1; text-align:center; padding:16px 0; text-decoration:none; color:var(--text-light); 
                   font-weight:600; font-size:0.9rem; border-bottom:3px solid transparent; 
                   transition:all .2s; }
        .nav-tab:hover { color:var(--text); }
        .nav-tab.active { color:var(--primary); border-bottom-color:var(--primary); }

        /* === IFRAME F√ñR KALKYLATORERNA === */
        main { flex-grow:1; background:var(--bg); }
        #contentFrame { width:100%; height:100vh; border:none; display:block; background:var(--bg); }
        
    </style>
</head>
<body>

    <div class="app-container">
        
        <header>
            <div class="header-content">
                <div class="logo-text">Sk√§rdata PRO</div>
                <button id="themeToggle" class="theme-toggle">üåô</button>
            </div>
        </header>

        <nav class="nav-bar" id="navBar">
            <a href="#planfras" class="nav-tab active" data-path="kalkylatorer/planfras.html" data-route="planfras">
                Planfr√§sning
            </a>
            
            <a href="#borrning" class="nav-tab" data-path="kalkylatorer/borrning.html" data-route="borrning">
                Borrning
            </a>
            
            <a href="#dynamisk" class="nav-tab" data-path="kalkylatorer/frasning.html" data-route="dynamisk">
                Dynamisk Fr√§sning
            </a>
        </nav>

        <main>
            <iframe id="contentFrame" src="" title="Kalkylator"></iframe>
        </main>
        
    </div>

<script>
    const contentFrame = document.getElementById('contentFrame');
    const navBar = document.getElementById('navBar');
    const themeToggle = document.getElementById('themeToggle');
    
    // === 1. TEMAHANTERING ===
    function initTheme() {
        // Kontrollera om anv√§ndaren har en sparad preferens
        const savedTheme = localStorage.getItem('theme');
        const systemDark = window.matchMedia('(prefers-color-scheme: dark)').matches;

        if (savedTheme === 'dark' || (!savedTheme && systemDark)) {
            document.body.classList.add('dark');
            themeToggle.textContent = '‚òÄÔ∏è';
        } else {
            themeToggle.textContent = 'üåô';
        }

        // Lyssna p√• klick p√• temaknappen
        themeToggle.addEventListener('click', toggleTheme);
    }

    function toggleTheme() {
        const isDark = document.body.classList.toggle('dark');
        localStorage.setItem('theme', isDark ? 'dark' : 'light');
        themeToggle.textContent = isDark ? '‚òÄÔ∏è' : 'üåô';
        
        // Meddela iframe om temabyte
        // Detta √§r viktigt f√∂r att synkronisera med kalkylatorfragmenten
        if (contentFrame.contentWindow) {
            contentFrame.contentWindow.postMessage({ theme: isDark ? 'dark' : 'light' }, '*');
        }
    }
    
    // Lyssna p√• temaf√∂r√§ndringar fr√•n systemet i realtid
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
        // Om ingen manuell preferens sparats, f√∂lj systemet
        if (!localStorage.getItem('theme')) {
            if (e.matches) {
                document.body.classList.add('dark');
                themeToggle.textContent = '‚òÄÔ∏è';
            } else {
                document.body.classList.remove('dark');
                themeToggle.textContent = 'üåô';
            }
        }
    });

    // === 2. NAVIGATION OCH URL-HANTERING ===

    // Lyssna p√• klick p√• nav-flikarna
    navBar.addEventListener('click', (e) => {
        const target = e.target.closest('.nav-tab');
        if (target) {
            e.preventDefault();
            const route = target.dataset.route;
            // Uppdatera URL:en (hash) och ladda inneh√•llet
            history.pushState(null, '', `#${route}`);
            handleRoute();
        }
    });

    // Lyssna p√• fram√•t/bak√•t i webbl√§saren
    window.addEventListener('popstate', handleRoute);

    // Huvudfunktion f√∂r att hantera URL-hash och ladda r√§tt fil
    function handleRoute() {
        // Ta bort # och eventuella parametrar fr√•n hash
        const hash = window.location.hash.substring(1).split('?')[0]; 
        const route = hash || 'planfras'; // Standardvy om ingen hash finns

        const targetTab = document.querySelector(`.nav-tab[data-route="${route}"]`);

        if (targetTab) {
            // 'Klick'-simulering f√∂r att ladda filen och uppdatera utseendet
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            targetTab.classList.add('active');
            contentFrame.src = targetTab.dataset.path;
        } else {
            // Om route √§r ok√§nd, ladda standard (Planfr√§sning)
            contentFrame.src = document.querySelector('.nav-tab[data-route="planfras"]').dataset.path;
            document.querySelector('.nav-tab[data-route="planfras"]').classList.add('active');
            history.replaceState(null, '', '#planfras');
        }
    }
    
    // === 3. SERVICE WORKER REGISTRERING (PWA) ===
    function registerServiceWorker() {
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js')
                .then(registration => {
                    console.log('ServiceWorker registration successful:', registration.scope);
                })
                .catch(error => {
                    console.error('ServiceWorker registration failed:', error);
                });
            });
        }
    }

    // === START ===
    document.addEventListener('DOMContentLoaded', () => {
        initTheme();
        handleRoute(); // Se till att r√§tt kalkylator laddas vid start/refresh
        registerServiceWorker(); // Starta PWA-v√§ktaren
    });
</script>
</body>
</html>
